name: Tagged Release

on:
  push:
    tags:
      - "v*"

jobs:
  build:
    name: Build tagged release
    runs-on: ubuntu-latest
   steps:
    - uses: actions/checkout@v2
        with:
          fetch-depth: 0
    - name: Set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: Build project with Maven
      run: mvn clean install
    - name: Get version
      id: project
      run: echo ::set-output name=version::$(mvn -q -Dexec.executable=echo -Dexec.args='${project.version}' --non-recursive exec:exec)
      #run: echo ::set-output name=version::$(mvn org.apache.maven.plugins:maven-help-plugin:2.1.1:evaluate -Dexpression=project.version)
    - uses: "marvinpinto/action-automatic-releases@latest"
      with:
        prerelease: false
        files: |
          onprom-toolkit/target/onprom-toolkit-${{ steps.currenttag.outputs.version }}.jar
          LICENSE.txt
          README.md
